@model Standups.ViewModels.HomeVM

@{
    ViewBag.Title = "Standup Meetings";
}

@if (!Model.IsAuthenticated)
{
    @*Present a welcome to non-registered visitors*@
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2>Welcome 2023-24 class &#x1F438;</h2>
            <p>
                Please register for an account so you can begin filling out meeting reports for class! <i class="bi bi-hand-thumbs-up-fill text-success"></i>
            </p>
            <p>
                <a id="register-link" asp-area="Identity" asp-page="/Account/Register" class="btn btn-warning btn-lg">Register</a>
            </p>
        </div>
    </div>
}
else
{
    if (Model.NeedsGroup)
    {
        <div class="row justify-content-center">
            <div class="col-md-8">
                <p class="display-4">Before you can start filling out meeting reports you need to select your team: </p>
                <p><a asp-controller="MyAccount" asp-action="SelectGroup" id="group-needed" class="btn btn-warning btn-lg">Select your team</a></p>
            </div>
        </div>
    }
    else
    {
        <div class="row justify-content-center">
            <div class="col-md-4">
                <h2>New meeting report</h2>
                <p>
                    Have you filled out today's stand up meeting report yet?
                </p>
                <p class ="mt-3">
                    <a asp-controller="Meetings" asp-action="Create" class="btn btn-primary">New report</a>
                </p>
            </div>
            <div class="col-md-4">
                <h2>Past reports</h2>
                <p>Need to see your past meeting reports?</p>
                <p class="mt-3">
                    <a asp-controller="Meetings" asp-action="Index" class="btn btn-info">Past stand-up reports</a>
                </p>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <hr />
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <partial name="_QuestionsViewPartial" for="Questions">
            </div>
        </div>
    }
}

<div class="row mt-3">
    <div class="col">
        <h2>Want to receive our newsletter?</h2>
        <form id="newsletter">
            <div class="form-group">
                <label for="email">Enter your email address:</label>
                <input type="text" class="form-control" id="email" name="email" aria-describedby="emailHelp" placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
            <button type="submit" class="btn btn-primary">Subscribe</button>
        </form>
        <div class="alert alert-primary" id="already-a-subscriber-alert" style="display: none">
            <button type="button" class="close" data-hide="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="alert alert-success" id="subscribe-alert" style="display: none">
            Thank you!  You'll begin receiving our newsletter soon.
            <button type="button" class="close" data-hide="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        @*Just putting this here for convenience in the demo*@
        function showNewsletterMessage(data) {
            console.log(data);
            // If their email is already in the database then we can tell them they're already subscribed
            if (Array.isArray(data) && data.length) {
                
                // finish code here to tell them they're already subscribed
                $('#already-a-subscriber-alert').prepend(`<p>Hey ${data[0][0].UserName} you're already subscribed.  Thanks for checking!</p>`).show();
                //$('#already-a-subscriber-alert').show();
            }
            else {
                // Thank them
                $('#subscribe-alert').show();
            }
        }

        // AJAX call to send email in to subscribe to newletter
        function subscribeNewsletter(event) {
            event.preventDefault();
            let email = document.getElementById("email").value;
            $.ajax({
                url: `/API/EmailList/${email}`,
                method: 'GET',
                success: showNewsletterMessage
            });
        }

        // helper to dismiss the bootstrap alert http://jsfiddle.net/cQNFL/21/
        $(function () {
            $("[data-hide]").on("click", function () {
                $("." + $(this).attr("data-hide")).hide();
            });
        });

        document.getElementById('newsletter')
                .addEventListener('submit', subscribeNewsletter);
    </script>
}
